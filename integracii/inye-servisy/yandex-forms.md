# Yandex Forms

Создайте форму в Yandex Forms с вашими вопросами [https://forms.yandex.ru/](https://forms.yandex.ru/) и далее следуйте инструкции ниже.

{% hint style="warning" %}
Обращаем внимание!

Инструкция устарела.

[Для создания опросов и сбора заявок используйте лендинг "Квиз".](../../saity-dlya-biznesa/konstruktor-saitov/kviz.md)
{% endhint %}

## Настройка Yandex

{% hint style="danger" %}
**Обязательно!** Необходимо настроить предзаполнение скрытого поля с идентификатором клиента.
{% endhint %}

Скрытые поля формы можно использовать для автоматической передачи в форму служебных или вспомогательных параметров. Это позволяет добавить к ответам пользователей дополнительную информацию для анализа и сбора статистики.

В нашем случае нужно обязательно добавить поле sb\_id - в нем будет записан идентификатор пользователя в Salebot, чтобы после отправки формы данные отправлялись клиенту.

Чтобы настроить скрытый параметр, добавьте на форму вопрос типа _Короткий текст_ с названием sb\_id.

<figure><img src="../../.gitbook/assets/image (100).png" alt=""><figcaption></figcaption></figure>

Для этого вопроса включите опцию Скрытый вопрос.

В поле Идентификатор вопроса укажите sb\_id — это будет название GET-параметра.<br>

<figure><img src="../../.gitbook/assets/image (101).png" alt=""><figcaption></figcaption></figure>

Получите ссылку на форму и добавьте в конец URL-адреса GET-параметр ?sb\_id=#{client\_id}

> Пример ссылки на форму с GET-параметром:
>
> https://forms.yandex.ru/u/6191b18d99e21b1b45b9c82?sb\_id=#{client\_id}

Далее отправьте эту ссылку клиенту из бота.&#x20;

При переходе по ссылке в скрытое поле sb\_id автоматически будет подставляться значение из переменной #{client\_id}.

<mark style="color:red;">**sb\_id - это обязательное поле,**</mark> но вы таким же образом можете передавать и свои данные, например, utm\_source (предварительно добавив это поле в форму, как и sb\_id).

> _Пример ссылки с передачей данных с помощью поля в форме:_ https://forms.yandex.ru/u/6191b18d99e21b1b45b9c82?sb\_id=#{client\_id}\&utm\_source=telegram

## Отправить свой колбек после заполнения формы

По умолчанию после отправки формы клиенту придет колбэк **yandex\_form\_received**.&#x20;

<figure><img src="../../.gitbook/assets/image (68) (1).png" alt=""><figcaption></figcaption></figure>

Как настроить колбек со своим текстом, читайте далее.\
Для этого нужно создать еще одно скрытое поле с названием **callback\_text**, все делаете аналогично как и sb\_id.

<figure><img src="../../.gitbook/assets/image (102).png" alt=""><figcaption></figcaption></figure>

Есть 2 варианта использования этого поля\
\
Замените **стандартный колбек yandex\_form\_received для формы на ваш**, для этого нужно указать _Значение по умолчанию_ и не передавать параметр в ссылке (галочка _Скрытый вопрос_ - установлена ), иначе он будет взят из ссылки.

<figure><img src="../../.gitbook/assets/image (103).png" alt=""><figcaption></figcaption></figure>

**Для отправки уникального колбека** передавайте **callback\_text** в ссылке со своим значением так же, как и sb\_id, пример:\
https://forms.yandex.ru/u/6191b18d99e21b1b45b9c82?sb\_id=#{client\_id}\&callback\_text=test

## Настройка вебхука

{% hint style="warning" %}
<mark style="color:red;">**Обязательно!**</mark> Настройка вебхука должна производиться только после заполнения формы.
{% endhint %}

На странице нужной формы, перейдите во вкладку **Интеграции**

<figure><img src="../../.gitbook/assets/image (104).png" alt=""><figcaption></figcaption></figure>

Далее внизу выбираем API -> Запрос JSON-RPC POST

<figure><img src="../../.gitbook/assets/image (105).png" alt=""><figcaption></figcaption></figure>

<mark style="color:red;">**В поле URL**</mark> <mark style="color:red;">**указываем**</mark> ссылку **https://chatter.salebot.pro/yandex\_form/API\_KEY**\
где **API\_KEY** - апи-ключ из настроек проекта в SaleBot&#x20;

> Пример ссылки: https://chatter.salebot.pro/yandex\_form/43ad8d427073ea93377544cc4a408f89

В параметрах указываем **sb\_id** и значение выбираем _Ответ на вопрос_, указываем **sb\_id**

<figure><img src="../../.gitbook/assets/image (106).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (107).png" alt=""><figcaption></figcaption></figure>

Для **callback\_text** делаем тоже самое.

Так же можно добавить другие параметры, которые будут записаны **в отдельные переменные клиента** в SaleBot с указанными названиями. Например:

<figure><img src="../../.gitbook/assets/image (108).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
Будьте внимательны с названиями, чтобы не перетереть уже существующие переменные у клиента!
{% endhint %}

Чтоб сохранить все ответы в одну переменную, можно выбрать пункт _Ответы на вопросы_ и выбрать все или, те, которые нужны, а также указать формат JSON, чтоб с ними легче было работать:

<figure><img src="../../.gitbook/assets/image (109).png" alt=""><figcaption></figcaption></figure>

В итоге должна получиться такая настройка (параметры могут отличаться, если добавлены дополнительные):

<figure><img src="../../.gitbook/assets/image (110).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
Все переменные из формы будут записаны в переменные клиента Salebot.&#x20;
{% endhint %}

Сохраняем изменения. На этом настройка завершена.

_Пример значения переменной answers в диалоге клиента Salebot._&#x20;

В настройках  формы в эту переменную мы объединили ответы на все вопросы формы в формате Json&#x20;

<figure><img src="../../.gitbook/assets/image (69) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Для каждого вопроса формы можно указать отдельную переменную в настройках вебхука формы.
{% endhint %}

### Выдать ссылку на форму в боте:

Пример 1

<figure><img src="../../.gitbook/assets/image (111).png" alt=""><figcaption></figcaption></figure>

Пример 2

<figure><img src="../../.gitbook/assets/image (112).png" alt=""><figcaption></figcaption></figure>

## Онлайн-запись Salebot на Яндекс Картах

Яндекс Карты уже приносят компаниям новых клиентов, которые активно записываются онлайн. Каждый месяц через этот канал совершается более 500 тыс. онлайн-записей.

У вас есть возможность установить виджет онлайн-записи в интерфейс Яндекс Карт. При интеграции Яндекс создает свой виджет, основываясь на данных вашего филиала в Salebot.

Клиентам с этим виджетом будет гораздо проще записываться на услуги, потому что не нужно переходить на сайт, в другое приложение или звонить. Они смогут с легкостью создавать записи, при этом в приложении можно сразу проложить маршрут до места.

### Подключение онлайн-записи на Яндекс Картах возможно при соблюдении условий:

1\. Вид деятельности, указанный в карточке организации на Яндекс Картах, доступен для онлайн-записи через Яндекс Карты. Список таких видов деятельности можно посмотреть по [ссылке ](https://yandex.ru/support/business-priority/manage/categories-all.html#categories-all.)

2\. Страны: Россия и Беларусь.

3\. Оплаченная подписка Salebot "Бизнес" и выше.

{% hint style="success" %}
Подключение интеграции бесплатно.
{% endhint %}

Карточка вашей организации появится только в случае, если у вас доступна для онлайн-записи хотя бы одна индивидуальная услуга. Услуги для групповых событий не будут отображаться в виджете Яндекс Карт.

### Настройка интеграции

1\. Перед подключением интеграции убедитесь, что ваша организация [добавлена на Яндекс.Карты](https://yandex.ru/support/maps/concept/add_place.html).

2\. В Salebot перейдите в раздел «CRM» > «Воронки», выберите воронку и нажмите «Редактировать воронку». В открывшихся настройках найдите раздел «Настройка онлайн-записей». Переведите чекбокс  «Интеграция Онлайн-записей с Yandex.Maps» в активный статус и заполните поле «Адрес компании».

<figure><img src="../../.gitbook/assets/2024-02-01_14-40-17.png" alt=""><figcaption></figcaption></figure>

3\. Для отображения кнопки онлайн-записи на Яндекс.Картах необходимо, чтобы информация в Salebot совпадала с информацией из вашей карточки компании в Яндекс Картах. Удостоверьтесь, что название и адрес компании совпадают.

4\. Нажмите кнопку «Сохранить», что изменения вступили в силу. После подключения интеграции кнопка «Записаться онлайн» появится в Яндекс Картах в течение 7-10 дней. Если по истечении этого времени кнопка не отображается, обратитесь в техподдержку Яндекса и проверьте правильность введенных данных в настройках филиала в Salebot.

{% hint style="info" %}
Примечания

* Если у вашей компании появился дубль в Яндекс Картах, то вы можете прямо на Яндекс Картах сообщить о нем. Для этого войдите в профиль организации и в разделе «Обзор» нажмите «Исправить неточность».
* В данный момент функционалы онлайн-оплаты и онлайн-продажи недоступны для виджетов онлайн-записи через Яндекс Карты.
* Яндекс выводит в свой виджет только услуги без предоплаты. Услуги с обязательной и необязательной онлайн-предоплатой в нем не отобразятся.
{% endhint %}

При онлайн-записи на Яндекс Картах SMS с кодом для подтверждения отправляется от Яндекса.

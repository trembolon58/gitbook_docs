# MANGO OFFICE

## Как подключить сервис

Для подключения Mango к Salebot необходимо получить Api-ключ интеграции и API salt для генерации подписи.  Для этого следует зайти в личный кабинет -> интеграции и внизу страницы выбрать Api- коннектор:

![Личный кабинет Mango Office](https://lh5.googleusercontent.com/6NsdD5QAErYvPzuYZ8PnPt8IGkbNPrTmaeI4GT2EhhWm1CenyjVPUM2HYy81az34acEr8VMO5Z62fMQWtNYowwGE-1zCFWAeFzBupk8SSk_RgjCYXSv5BlvUyVTMEmv83HV69KPEx9UlpsR-FA)

![](https://lh6.googleusercontent.com/JySt0HDLk_MopsSdjTM7TV25Qw19kAchsnw_tAAITr0WCEzN30-76GCCry5BKi7ndEtKzfhs9Mz7stoBPDtUHbMsApz31SdKg7GPcgfag-vh-CqOdP8MFrHPL8cBAxA3USmbr-l1DaX5Gr1I7g)

После подключения услуги появятся необходимые данные: \
Уникальный код вашей АТС - mango\_Api\_key(например, 2jhj35hjkbv225nlklmbnv2) \
Ключ для создания подписи - mango\_Api\_salt(например, fds9sdgg4sdgsg2456sgsg8)

![Подключение API Connector](https://lh4.googleusercontent.com/IpN_m_IjU2KNlPGwNMdER0u6VQ0wZg4DQhxQFMAGL98xDcmYbMPV22uImOL9KvUoifSJERuUzFHA798IXIXHkcGCvtJmKNhUUCbVLZFrXZFCHph2Z0zH9dLwryumpuBoeFxajO6IsCsXBM54bg)

Эти данные требуется ввести в окне подключения MANGO OFFICE в Salebot - Телефония:

![Salebot - Телефония](https://lh6.googleusercontent.com/0x0nmoS94MAiN3fSH60rVyUOkKjqtWlv9ih6T9aqZjN_aUTkxaPmZRVmFU5zfYHMV2nfJrQwLbKVzPHOBivjRD_gK3itsTHT3vjHHHe6lGYIdxRp3t0t_IzwR-IiK52B6NCXJ0SGnH4biXufXQ)

![Окно подключения MANGO](https://lh6.googleusercontent.com/tgxpMmdhnNbpB47ZckGP56a-HgKpJJZWjet4YYyHUccbzUDQS1yZGPnfc6b-zolp_0-UJTN03sFDXCfDMktOAocXTve5ttw4aFn70U-0CbqLynGR3Yu_oX4d8U2qWft7bTahEwmq_l0ZvuyDlQ)

Сервис Mango Office подключен!&#x20;

## **Настройка групп и сотрудников в MANGO OFFICE**

Однако для успешной работы с телефонией нам понадобится информация о сотрудниках и группах. В главном меню выберите раздел “Сотрудники” и создайте работника, присвоив в графе “внутренний номер” значение номера. В примере - 219.&#x20;

![Настройка телефонии Mango Office](https://lh6.googleusercontent.com/Ms2ugOryrkd35QmN-yEfyj91tSf6zAWckgPH1I5L0vlrjGH8qDZ5UUODrbtCNFcSzJp91WESbwBMf8aQClGEM9kd7208mybxxzKS4cI7od5rKtQI-g8Wv8n0LUc1if0Z8kNdmdYBrMkV_f3QqQ)

![Настройка телефонии Mango Office - раздел Сотрудники](https://lh4.googleusercontent.com/_eOg80YUfEl4r-Y0q6RcjE2TgSNZZMnXxcTjAZc1KHNDARMVD_S_H5zOPEE90RJbE2FPKjRaXInHI-NqqsVkbLWJDA8SdbVC6OCYOG2EuqfLJlOfBJTmshMcDFKSNMu6XJrQoiUmKN24D7_p2w)

![Настройка телефонии Mango Office - Карточка сотрудника](https://lh3.googleusercontent.com/N5QQW6WKmeUYc5sOGhuE_HihZGexe8ZaV_Fmgpz4qQGMyqceCMVhUv5wvccW64vwBdOXcE6GsTzD2BKzAPyWlqD5TlcnAGQA8T-Z0oPXd9u_Vu_GwEhVlT90J2OcvqSTJGYFzQ-q5VJ76YtJ2A)

Повторяем процедуру для всех сотрудников компании.

Если Вам понадобится работа с групповыми звонками, тогда следует перейти в подраздел “группы”**,** где необходимо настроить группу, заполнив все поля и присвоив ей уникальный номер(в примере “12345”)

![Настройка телефонии Mango Office - раздел Группы](https://lh6.googleusercontent.com/aoZaRCszlkGf3MwGwiYJabCoI0O2CLikJ0XmfHlPSrrZ3nQ0_h1DSPcq-VgJkV03HGPd_6wpYZfU-zpbAnwk03L97pnqDyavq9WoW5Ziacnk7A9MqnH9PtNUjLolgZB55WaaWllz92IxaUDRkw)

![Настройка телефонии Mango Office - Создание группы](https://lh5.googleusercontent.com/CkmnXbusWD12nT4RdTPNTt0hLbCY5turvbuB6h1-ppayWYMy2xxFTpqvAd0v-KS9kWh0VROSR88qHeiD79MMVHvokI4STyL6vRsBARHuz828t0zspN39wKCCF-ADCgohngURDwya2l5r6ugmyg)

![Настройка телефонии Mango Office - настройка группы](https://lh6.googleusercontent.com/65xQ8n7PiD_xA-daDzoaty4uuKwblex6JahTepNcTniHb7LSzGXEiEaTJesC0QbV8eZxb7KDQ6RERp-OclVuxOa5s6ufZzb83fXTvYSvBMSKSUlJb9VSm6SN6n8Bvwq3JuuD1WqXRUrUmci6cw)

## **Как происходит сопоставление данных клиента**

Для работы с телефонией используются номера в формате 71234567890 (должен начинаться с 7 (или с иного кода другой страны, например, 375), состоять из 11 и более цифр и не иметь лишних знаков и отступов). \
Последовательность сопоставления данных о клиенте: \
1\. Осуществляется поиск клиента Телефонии. Если клиент не найден, то происходит поиск по значениям всех переменных по всему списку клиентов проекта. Первая найденная запись о клиенте считается тем самым "искомым" клиентом. \
2.Если клиент не найден среди клиентов Телефонии и:\
\- к проекту подключен любой мессенджер, например, Whatsapp, то будет создан клиент Whatsapp с данным номером телефона. \
\- к проекту не подключены иные виды мессенджеров (Whatsapp, Viber, Instagram и т.д.), то будет создан клиент Телефонии. Такому клиенту Вы сможете совершать только звонки с получением информации о них. Написать такому клиенту возможности нет.

## Функция Salebot звонок на номер сотрудника

Для того, чтобы совершить звонок сотруднику из бота, необходимо использовать функцию **mango\_employee\_call(short\_employee\_number, client\_phone)**, \
которая принимает на вход следующие параметры: \
short\_employee\_number - короткий номер сотрудника в системе Mango, строка, пример - ‘219’ \
client\_phone - номер клиента, которому должен быть совершен звонок, строка, пример - '79004443322'.&#x20;

Пример реализации функции в боте:

<figure><img src="../../.gitbook/assets/2023-12-01_18-56-14.png" alt="" width="563"><figcaption></figcaption></figure>

## Функция звонок группе сотрудников в Salebot

Для того чтобы совершить звонок группе сотрудников, необходимо использовать функцию **mango\_group\_call(group\_number, line\_number, client\_phone)**, \
которая принимает на вход следующие параметры: \
**group\_number** - номер группы в системе Mango, строка, пример - ‘12345’ \
**line\_number** - виртуальный номер, который будет использован для переадресации звонков внутри группы, строка. Пример - ‘74992262961’ \
client\_phone - номер клиента, которому должен быть совершен звонок, строка, пример - '79004443322'&#x20;

Пример реализации функции в боте:

<figure><img src="../../.gitbook/assets/2023-12-01_18-57-52.png" alt="" width="563"><figcaption></figcaption></figure>

{% hint style="danger" %}
ВНИМАНИЕ! Тщательно проверьте настройки групповых звонков в MANGO! При неправильных настройках дозвона можно заспамить клиента вызовами!
{% endhint %}

## **Настройка звонков из карточки клиента**

Для настройки возможности осуществлять звонки непосредственно из карточки клиента введите сотрудников в систему Salebot. После регистрации сотрудника зайдите в редактирование его данных.

![](https://lh6.googleusercontent.com/6veqIs8487g_E3vLBXv0eh1koVRtJGqRLNsqZLf2GDmPIrGuaU_nQhxVJYGfrnqx82V7mKcfSV6oC5-QCUaj_WevLAx3CyQb4R5CLTRmGnA5Gkw5oOcMmkuYbE3ekd8CGOBcSS6-Zai2gKrLlg)

В позиции “Способ совершения телефонных звонков” выберите звонки по API Mango. \
\- Если выбрать пункт **Отключить звонки**, то этот сотрудник не сможет совершать звонки и иконка телефона возле номеров телефона у него не будет отображаться. \
\- **Звонки через приложение** - при нажатии на иконку телефона звонок будет перенаправлен в приложение, установленное для звонков на Вашем устройстве (Zopier и тд). \
\- **Звонки по API Mango** - при клике на иконку телефона АТС звонок поступит сначала сотруднику, чей id вы указали в карточке, а затем перенаправляет звонок клиенту.&#x20;

После выбора способа совершения телефонных звонков в “Звонки по API Mango” появится дополнительное поле, в которое следует вписать короткий номер Вашего сотрудника в системе Mango.

![](https://lh3.googleusercontent.com/rLEPWD0upwZLDNCt5ABu9nLKAe31DHYM5caKkB1xr9eoYXLfM1kOruPQQUVGurtgRdEiyxbQt-f2WTGGSuobLwuBlAEokU9Kx-omaw2CzGigARWb8FgVZOL4t8bJRGtcuBJ-esqlbl7clOAruA)

Для осуществления звонка выбранным методом достаточно в карточке клиента нажать на иконку голубой телефонной трубки рядом с его номером телефона:

![](https://lh3.googleusercontent.com/wWmeBnKfnH_UuX0-QpqrPWKLcUkOFutr4dyLuNWhK3aToziynQFwhIPG666MajYoZL0_xv5llSmY_Tt2gWqxfQrtYsqn4tpi4VPpEqPkIV5GtsKPx5TEKfeq4rKl7biZ4tDyk0GiFqypFrg35w)

## **Настройка вебхуков**

Для того чтобы настроить получение колбеков о статусе завершения звонка, необходимо в системе Mango перейти в “Интеграции”-”Api-коннектор”, далее  в разделе “Внешние системы” в поле “Адрес внешней системы” пропишите адрес вида: https://chatter.salebot.pro/mango\_webhook/<апи-ключ>, например, https://chatter.salebot.pro/mango\_webhook/2jhj35hjkbv225nlklmbnv2

![](https://lh6.googleusercontent.com/MPBVVffQOTSD_lUy5XIvmkpAMwl1vmWGSvlJKNu0SuLQFtqnD3_R0q7dYMPk-tsDMvrc-w1WL3qtemOT-cuFK50yghkAqWosSDmkCcvqzko8AHQg6LxOEHChjbHmS8iA9eYnjKuVFNjARGgMUQ)

В результате при завершении звонков в Salebot будет приходить уведомление следующего вида:

![](https://lh3.googleusercontent.com/OFt9Q6QGWALb7qGj2tS4vaqICBnglLVDzcelczjrTB244D0SP1Au32jpJB8YFGvZIl6CM8ZjEMOPrkg9YYaNSLj_8Yl4OLjkVXegu4ln48e8JC7zcx8E6CuMPyk55qZKO9m3lFy-VZ4SLOcVRQ)

В системе используются множество статусов, обозначающих различные условия завершения звонка. При его наличии код будет присылаться в колбеке.

### Список кодов результатов&#x20;

Ниже приведен список кодов результатов выполнения команд или запросов, завершения вызовов, записей разговоров. В каждом конкретном случае возможно некоторое подмножество результатов. Все коды разделены на классы и подклассы. Например, если внешняя система получает код 2219, то она должна его интерпретировать как 2210 (класс 221х) "Доступ ограничен периодом использования", если 1090 — 1000 (класс 1ххх) "Действие успешно выполнено"

### Код Описание&#x20;

1000 -> Действие успешно выполнено \
1100 -> Вызов завершен в нормальном режиме \
1110 -> Вызов завершен вызывающим абонентом \
1111 -> Вызов не получил ответа в течение времени ожидания \
1120 -> Вызов завершен вызываемым абонентом \
1121 -> Получен ответ "занято" от удаленной стороны \
1122 -> Вызов отклонен вызываемым абонентом \
1123 -> Получен сигнал "не беспокоить" \
1124 -> Вызов завершен по причине недоступности сотрудника \
1130 -> Ограничения для вызываемого номера \
1131 -> Вызываемый номер недоступен \
1132 -> Вызываемый номер не обслуживается \
1133 -> Вызываемый номер не существует \
1134 -> Превышено максимальное число переадресаций \
1140 -> Вызовы на регион запрещены настройками ВАТС \
1150 -> Ограничения для вызывающего номера \
1151  -> Вызывающий номер в «черном» списке \
1152  -> Вызывающий номер не найден в «белом» списке \
1160  -> Вызов на группу не удался \
1161  -> Удержание запрещено настройками ВАТС \
1162  -> Очередь удержания заполнена \
1163  -> Превышено время ожидания в очереди удержания \
1164  -> Все операторы в данный момент недоступны \
1170 -> Вызов завершен согласно схеме переадресации \
1171  -> Неверно настроена схема переадресации \
1180 -> Вызов завершен командой пользователя \
1181  -> Вызов завершен по команде из внешней системы \
1182 -> Вызов завершен перехватом на другого оператора (только для исходящих плеч) \
1183 -> Назначен новый оператор (при команде ApiConnect, обычно при переводах) \
1190 -> Вызываемый номер неактивен либо нерабочее расписание \
1191 -> Вызываемый номер неактивен (снят флажок активности ЛК) \
1192 -> Вызываемый номер неактивен по расписанию

Ниже последуют коды нераспространенных ошибок

1200 -> Ошибка сессий КЦ \
1201 -> Достигнут лимит подключений \
1202 -> Данные сессии не найдены \
1210 -> Сервер КЦ не может принять подключение \
1211 -> Режим обслуживания \
1212 -> Сервер отключен от БД (БРТ) \
1230 -> Завершение сессии КЦ по независимым от пользователя причинам \
1231 -> Перезагрузка сервера КЦ \
1232 -> Сессия завершена администратором \
1233 -> Сессия завершена администратором, рекомендовано восстановление \
1234 -> Сессия завершена администратором, рекомендовано оставаться в оффлайн \
1235 -> Сервер отключился от БД (переход в БРТ) \
1236 -> Изменены критичные данные сессии (логин, пароль, номер телефона, и т.д.) \
2000 -> Ограничение биллинговой системы \
2100 -> Доступ к счету невозможен \
2110 -> Счет заблокирован \
2120 -> Счет закрыт \
2130 -> Счет не обслуживается (frozen) \
2140 -> Счет недействителен \
2200 -> Доступ к счету ограничен \
2210 -> Доступ ограничен периодом использования \
2211 -> Достигнут дневной лимит использования услуги \
2212 -> Достигнут месячный лимит использования услуги \
2220 -> Количество одновременных вызовов/действий ограничено \
2230 -> Услуга недоступна \
2240 -> Недостаточно средств на счете \
2250 -> Ограничение на количество использований услуги в биллинге \
2300 -> Направление заблокировано \
2400 -> Ошибка биллинга \
3000 -> Неверный запрос \
3100 -> Переданы неверные параметры команды \
3101 -> Запрос выполнен по методу, отличному от POST \
3102 -> Значение ключа не соответствуют рассчитанному \
3103 -> В запросе отсутствует обязательный параметр \
3104 -> Параметр передан в неправильном формате \
3105 -> Неверный ключ доступа \
3200 -> Неверно указан номер абонента \
3300 -> Объект не существует \
3310 -> Вызов не найден \
3320 -> Запись разговора не найдена \
3330 -> Номер не найден у ВАТС или сотрудника \
3340 -> Файл не найден \
4000 -> Действие не может быть выполнено \
4001 -> Команда не поддерживается \
4002 -> Продолжительность записи меньше минимально возможной в ВАТС, запись не будет сохранена \
4100 -> Выполнить команду по логике работы ВАТС невозможно \
4101 -> Вызов завершен либо не существует \
4102 -> Запись разговора уже осуществляется \
4200 -> Связаться с абонентом в данный момент невозможно \
4300 -> SMS сообщение отправить не удалось \
4301 -> SMS сообщение устарело \
4391 -> SMS сообщение утеряно (статус возвращает внешний оператор) \
4392 -> SMS сообщение отклонено (статус возвращает внешний оператор) \
4393 -> SMS сообщение отменено (статус возвращает внешний оператор) \
4400 -> Невозможно добавить участника в конференцию \
4401 -> Аппаратная ошибка \
4402 -> Сервис не доступен \
4403 -> Недостаточно ресурсов \
4404 -> Превышено ограничение на количество участников конференции \
4405 -> Подключение запрещено настройками комнаты конференций \
4500 -> Ограничения системы безопасности \
4501 -> Установлено ограничение частоты звонков \
4502 -> Вызывающий номер в черном списке входящих номеров \
4503 -> Превышен максимальный размер файла \
4504 -> Не удалось определить размер файла \
4505 -> Формат файла не соответствует разрешенному \
5000 -> Ошибка сервера \
5001 -> Перезапуск коммутатора, выполняется при срабатывании какого-либо ограничения канала или уровня на коммутаторе. \
5002 -> Перезапуск коммутатора по команде администратора / разработчика \
5003 -> Технические проблемы, внутренняя ошибка на коммутаторе \
5004 -> Проблемы доступа к базе данных коммутатора: не удалось подключиться к базе данных или в результате обработки запроса на манипуляцию с данными (чтение/вставка/удаление/ и так далее) в базе данных выдано сообщение об ошибке. \
5007 -> Во сторонней системе, связанной с коммутатором, выдано сообщение о внутренней ошибке. Сторонняя система не доступна коммутатору. \
5101 -> Нет продукта ЦОВ/ Контакт центр \
5102 -> Превышен лимит активных кампаний \
5103 -> Превышен лимит кампаний \
5105 -> Указанный при создании кампании "abonent\_id" в поле "created by" не существует \
5106 Не удалось вставить задания из-за неподходящего статуса кампании \
5107 -> Количество заданий для кампании превышает допустимое значение (10 000) \
5212 -> Нет активных номеров. Укажите хотя бы один номер \
6000 -> Доставка факса не выполнялась \
6010 -> Технические проблемы сервиса факс-рассылок \
6011 -> Указанный в задании на рассылку номер недоступен в течение часа \
6012 -> Указанный в задании на рассылку номер не существует \
6013 -> На указанном номере не установлен факс-аппарат \
6014 -> Адресат отказался принимать факс \
6100 -> Ошибка при преобразовании факса \
6101 -> Превышен допустимый размер исходного файла (10 мегабайт) \
6102 -> Превышено допустимое число страниц (30)

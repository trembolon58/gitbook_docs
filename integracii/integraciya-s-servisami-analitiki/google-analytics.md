# Google Analytics

{% hint style="info" %}
Отслеживание действий с помощью интеграции Google Analytics доступно только через конструктор сайтов Salebot.
{% endhint %}

## Регистрация аккаунта и создание потока данных

Структуру сервиса Google Analytics 4 составляют три элемента:

1\) **Аккаунт -** это ресурсы, принадлежащие одной компании.

2\) **Ресурс** - это интернет-проект, у которого может быть несколько витрин. Например, Ozon — ресурс, у которого четыре витрины: маркетплейс, сайт для продавцов и два приложения для Android и iOS.

3\) **Поток данных -** это данные для ресурса с одной из витрин — например, с сайта.

На каждую витрину устанавливается код отслеживания. Другие его названия — счётчик, тег. Он формирует поток данных — отслеживает все действия пользователей на сайте и передаёт их в сервис. Благодаря этому, например, можно видеть в отчётах, сколько человек посетили сайт в прошлом месяце или оформили заказ в боте.

Новые счетчики по умолчанию создаются в версии GA4. Он работает на 2 версии протокола.

Создайте аккаунт на [странице](https://analytics.google.com):&#x20;

<figure><img src="../../.gitbook/assets/image (184).png" alt=""><figcaption></figcaption></figure>

Укажите название аккаунта:

<figure><img src="../../.gitbook/assets/image (185).png" alt=""><figcaption></figcaption></figure>

Далее создаем Ресурс: для начала укажите своё название для Ресурса

<figure><img src="../../.gitbook/assets/image (186).png" alt=""><figcaption></figcaption></figure>

&#x20;Заполните необходимую информацию о компании:

<figure><img src="../../.gitbook/assets/image (187).png" alt="" width="505"><figcaption></figcaption></figure>

Для создания аккаунта необходимо выставить галочки в чекбоксы о том, что принимаете "Условия обработки данных" и "защиты данных" и нажать кнопку "Принимаю".

<figure><img src="../../.gitbook/assets/image (188).png" alt="" width="402"><figcaption></figcaption></figure>

На этом создание РЕСУРСА закончено.

<mark style="color:green;">**Настраиваем сбор данных.**</mark>&#x20;

Для этого переходим <mark style="color:orange;">**в панели Администратор**</mark> (по умолчанию после создания Ресурса вы попадаете в эту панель) откройте раздел <mark style="color:orange;">**Потоки данных**</mark> и выберите источник <mark style="color:orange;">**Веб**</mark> (для сбора данных с сайта)

<figure><img src="../../.gitbook/assets/image (189).png" alt=""><figcaption></figcaption></figure>

Далее <mark style="color:orange;">**указываем ссылку на сайт для сбора данных**</mark>. Можно использовать ссылку на минилендинг с доменом конструктора Salebot:&#x20;

(пример https://salebot.site/md/<название\_&#x432;_\__&#x441;сылке>)&#x20;

<figure><img src="../../.gitbook/assets/image (190).png" alt=""><figcaption></figcaption></figure>

ИЛИ установить на минилендинг(сайт) свой домен (пример ниже):

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

После клика <mark style="color:orange;">**по кнопке Создать**</mark> откроется вкладка "Сведения о веб-потоке":

<figure><img src="../../.gitbook/assets/image (192).png" alt=""><figcaption></figcaption></figure>

На изображении:

1 - <mark style="color:orange;">**Идентификатор потока данных**</mark> (**ga4\_measurement\_id**).  Данный идентификатор указывается <mark style="color:orange;">**в общих настройках минилендинга во вкладке Аналитика**</mark> для сбора данных.

Пример:&#x20;

<figure><img src="../../.gitbook/assets/image (193).png" alt="" width="470"><figcaption><p>Идентификатор потока данных в настройках минилендинга:</p></figcaption></figure>

2 - <mark style="color:orange;">**Секретный ключ API.**</mark> Переходим в эту вкладку,  чтоб получить **ga4\_api\_secret:**

<figure><img src="../../.gitbook/assets/image (194).png" alt=""><figcaption></figcaption></figure>

Нажмите <mark style="color:orange;">**кнопку Создать**</mark>. Будет **сгенерирован Секретный ключ API**, который в дальнейшем потребуется для настройки передачи данных в бота. Скорируйте данный ключ.

<mark style="color:orange;">**Добавляем в переменные проекта**</mark> две переменные:

**ga4\_measurement\_id** - Идентификатор потока данных (пример G-LYXWRKECY4) **ga4\_api\_secret** - Секретный ключ API (пример ZSZ2IDt2Sd8JMAUW9WnJGA)

<figure><img src="../../.gitbook/assets/image (195).png" alt=""><figcaption></figcaption></figure>

На этом основные настройки на стороне Google.Аналитики выполнены.

Для просмотра информации/отчётов по данному ресурсу или аккаунту перейдите на любую из вкладок меню в левой части экрана:

<figure><img src="../../.gitbook/assets/image (196).png" alt=""><figcaption></figcaption></figure>

#### Как перейти в панель АДМИНИСТРАТОР в Google.Аналитике из отчётов:&#x20;

В нижней панели слева ВНИЗУ есть значок шестеренки. Нажмите на нее, чтобы зайти в настройки ресурса как Администратор:

<figure><img src="../../.gitbook/assets/image (197).png" alt="" width="306"><figcaption></figcaption></figure>

## Установить счётчик на минилендинг

Установить счётчик на минилендинг можно одним из удобных способов.

Добавить счётчик на минилендинг можно установив тег Google в настройках CSS и JS минилендинга в поле HTML-код HEAD.

Другой способ, в настройках минилендинга в разделе Аналитика заполнить поля  Идентификатора потока данных и Названия события конверсии.

{% hint style="warning" %}
Заполнение данных этих полей равносильно добавлению тега Goggle в настройках CSS и JS минилендинга в поле HTML-код HEAD.
{% endhint %}

Как создать счетчик (Поток данных) на странице [https://analytics.google.com/](https://analytics.google.com/)  описано выше.

Ниже выберите один из способов установки счётчика на минилединг для добавления счётчика на минилендинг:

{% tabs %}
{% tab title="Настройки минилендинга - > Аналитика" %}
### Подключение счётчика в настройках Аналитики минилендинга

{% hint style="warning" %}
Заполнение полей в разделе Аналитика равносильно добавлению тега Goggle в настройках CSS и JS минилендинга в поле HTML-код HEAD.
{% endhint %}

Откройте минилендинг для редактирования:&#x20;

<figure><img src="../../.gitbook/assets/image (198).png" alt=""><figcaption></figcaption></figure>

Перейдите по кнопке Настройки в раздел Аналитика:

<figure><img src="../../.gitbook/assets/image (199).png" alt=""><figcaption></figcaption></figure>

В настройках минилендинга (раздел Аналитика) указываем Идентификатор потока данных и название события-конверсии:

<figure><img src="../../.gitbook/assets/image (200).png" alt=""><figcaption></figcaption></figure>

#### <mark style="color:orange;">Как получить данные Идентификатор потока данных и название события-конверсии</mark>

В настройках Потока данных Google Аналитики скопируйте "Идентификатор потока данных" . Его необходимо будет указать в настройках минилендинга.&#x20;

<figure><img src="../../.gitbook/assets/image (201).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Можно скопировать идентификатор в ранее созданном потоке данных или создать новый, как описано в разделе ["Регистрация аккаунта](google-analytics.md#registraciya-akkaunta-i-sozdanie-potoka-dannykh)
{% endhint %}

Чтобы клики по кнопкам мессенджера вызывал событие конверсии, нужно создать  "Событие-конверсия" в разделе Конверсии.

Чтобы создать его перейдите в раздел Конверсии -> События-конверсии -> Создать событие-конверсию --> Напишите название для данного события.

<figure><img src="../../.gitbook/assets/image (202).png" alt=""><figcaption></figcaption></figure>

Имя события-конверсии может быть любым, его нужно передать в настройки минилединга. Например, click

Событие-конверсия будет срабатывать по нажатию на любую кнопку минилендинга.

{% hint style="success" %}
Если вы хотите разделить конверсии для разных мессенджеров, в настройках минилендинга название события-конверсии должно заканчиваться на нижнее подчеркивание “\_”&#x20;
{% endhint %}

Если ввести в поле “Название события конверсии” “click\_button\_”, для каждого мессенджера будет исходить разная конверсия.\
click\_button\_vk - для ВКонтакте\
click\_button\_telegram - для Телеграм\
click\_button\_viber - для Вайбера\
click\_button\_whatsapp - для Ватсапа\
click\_button\_ok - для Одноклассников\
click\_button\_instagram - для Инстаграма

{% hint style="success" %}
Само названия события-конверсии может быть любой, главное, чтобы в конце было нижнее подчеркивание. В отчетах аналитики к нему будет добавлено имя мессенджера.
{% endhint %}

{% hint style="danger" %}
Событие-конверсия после создания может обновляться до 24-х часов. Для проверки, вы можете создать событие-конверсию и проверить её в разделе “Отчет в реальном времени” внизу странице в графе “Конверсии”.&#x20;

Если все установлено правильно, там появятся имена и количество конверсий.
{% endhint %}

<figure><img src="../../.gitbook/assets/image (203).png" alt=""><figcaption></figcaption></figure>
{% endtab %}

{% tab title="Настройки минилендинга - > тег Goggle(CSS и JS)" %}
### Подключение счётчика в настройках минилендига с помощью тега Goggle

У вас должен быть создан Поток данных(счётчик), как было [описано в статье выше](https://docs.salebot.pro/integracii/analitika/integraciya-chatbota-s-google-analitics#registraciya-akkaunta-i-sozdanie-potoka-dannykh).

Заходим в настройки потока данных Google  Аналитики:

<figure><img src="../../.gitbook/assets/image (204).png" alt=""><figcaption></figcaption></figure>

Переходим на вкладку "Просмотр инструкции тега":

<figure><img src="../../.gitbook/assets/image (205).png" alt=""><figcaption></figcaption></figure>

Открываем вкладку "Установить вручную", чтобы получить код тега для установки в минилендинг. Копируем код тега:

<figure><img src="../../.gitbook/assets/image (206).png" alt=""><figcaption></figcaption></figure>

Переходим в настройки минилендинга и в разделе "CSS и JS" в поле "HTML-код HEAD" устанавливаем скопированный тег Google:

<figure><img src="../../.gitbook/assets/image (207).png" alt=""><figcaption></figcaption></figure>

После этого нажимаем кнопку Сохранить, чтобы внесенные изменения применились.
{% endtab %}
{% endtabs %}



## Как передать Google Client ID(\_ga) с минилендинга в переменные

Чтобы передать идентификатор посетителя, в настройках минилендинга установите галочку Google Client ID(\_ga). После запуска бота в диалоге с клиентом с данного минилендинга появится переменная **\_ga**.

**Шаг 1.** Зайдите в редактирование минилендинга. Верхняя строка поля конструктора минилендингов --> кнопка Настройки:

<figure><img src="../../.gitbook/assets/image (208).png" alt=""><figcaption></figcaption></figure>

**Шаг 2.** Откройте раздел Аналитика и поставьте галочку в чекбоксе Google Client ID(\_ga):&#x20;

<figure><img src="../../.gitbook/assets/image (209).png" alt="" width="563"><figcaption></figcaption></figure>

**Шаг 3.** При запуске бота с минилендинга  переменная **`_ga`** появится в информации о клиенте в правой части диалога:

<figure><img src="../../.gitbook/assets/image (210).png" alt="" width="437"><figcaption></figcaption></figure>



## **Как передать события в GA из Salebot**

{% tabs %}
{% tab title="Google Analytics 4" %}
Чтобы передать событие в Google Analytics при переходе в этап, в поле Калькулятор, необходимо вызвать функцию **ga4\_event()** с необходимыми параметрами.

**`ga4_event('event_name', 'params', 'debug', 'measurement_id', 'api_secret')`**

**event\_name** (**Обязательно) -** Название события.&#x20;

**params** - Параметры события (Необязательно). Пример '{"key": "value", "another\_key": "another\_value"}'&#x20;

**debug** - Признак теста(Необязательно). Может быть передано любое значение, достаточно передать значение 1. Позволяет протестировать корректность построения запроса без передачи данных на сервер аналитики.

_<mark style="color:blue;">Если несколько счетчиков, то можно передать</mark> <mark style="color:blue;"></mark><mark style="color:blue;">**measurement\_id**</mark> <mark style="color:blue;"></mark><mark style="color:blue;">в паре с</mark> <mark style="color:blue;"></mark><mark style="color:blue;">**api\_secret**</mark>_

**measurement\_id** (Необязательно) - Идентификатор потока данных (пример G-LYXWRKECY4). &#x20;

**api\_secret** - Секретный ключ API (пример , ''ZSZ2IDt2Sd8JMAUW9WnJGA)

<mark style="color:red;">**Важно!!**</mark>&#x20;

<mark style="color:red;">**measurement\_id**</mark> <mark style="color:red;"></mark><mark style="color:red;">и</mark> <mark style="color:red;"></mark><mark style="color:red;">**api\_secret**</mark>  <mark style="color:red;"></mark><mark style="color:red;">в параметрах функции</mark>  <mark style="color:red;"></mark><mark style="color:red;">**приоритетнее**</mark> <mark style="color:red;"></mark><mark style="color:red;">тех, что указаны в настройках проекта.</mark>



**Примеры запросов:**

`result = ga4_event('login', '{"method":"Telegram"}')`

`result = ga4_event('purchase', '{"currency": "USD", "transaction_id": "T_1234", "value":"12.21"}')`

`/* Ниже пример функции, если в проекте используются несколько счётчиков аналитики (потоков данных*/`

`result = ga4_event('login', '{"method":"Telegram"}', '', 'G-LYXWRKECY4', 'ZSZ2IDt2Sd8JMAUW9WnJGA')`





<mark style="color:orange;">**Все возможные события с параметрами**</mark> описаны здесь:&#x20;

{% embed url="https://developers.google.com/gtagjs/reference/ga4-events" %}

### Тестирование запросов

Если передать последний параметр, то будет отправлен тестовый запрос, который возвращает больше информации. Если запрос без ошибок, то в ответ придет:

{'validationMessages': \[]} если в запросе есть ошибка, то в ответе будет ее описание, например: {'validationMessages': \[{'fieldPath': 'events', 'description': 'Event at index: \[0] has no name.', 'validationCode': 'NAME\_INVALID'}]}

<mark style="color:green;">**Примеры тестирования запросов:**</mark>

`result = ga4_event('login', '{"method":"Telegram"}', '1')`

`result = ga4_event('purchase', '{"transaction_id": "T_1234", "value":"12.21"}', '1')`
{% endtab %}

{% tab title="Universal Analytics(УСТАРЕВШАЯ ВЕРСИЯ)" %}
## **Как передать события в GA из Salebot**

Чтобы передать событие в Google Analytics при переходе в этап, в поле Калькулятор, необходимо вызвать функцию **ga\_event()** с необходимыми параметрами.

**ga\_event('категория', 'действие события'**, 'ярлык', 'ценность события',  '{"название параметра": "значение", "название параметра2": "значение3"}', 'признак теста')

**где:**

1. категория события - обязательный параметр
2. действие события - обязательный параметр
3. ярлык события
4. ценность события. Передается в целых числах, запишется в той валюте, которая указана в настройках представления
5. словарь с дополнительными параметрами пример: '{"ti":"#{order\_id}", "tr":"25", "tcc":"#{promocode}"}'
6. признак теста - необязательный параметр. Может быть передано любое значение, достаточно передать значение 1. Позволяет протестировать корректность построения запроса без передачи данных на сервер аналитики

{% hint style="warning" %}
<mark style="color:red;">**Внимание!**</mark> Не забывайте убирать признак теста после проверки.
{% endhint %}

**Примеры вызова функции:**

ga\_event('продажа', 'просмотр списка')\
ga\_event('Salebot', 'Вход в бот', '#{tag}', '100', '{"ti":"#{order\_id}", "tr":"#{price}", "tcc":"#{promocode}"}')\
ga\_event('Salebot', 'Вход в бот', '#{tag}', '100')\
ga\_event('Salebot', 'Вход в бот', "", '20')

**Пример тестового вызова функции:**

ga\_event('Salebot', 'Вход в бот', '', '', '', **1**)

В результате тестового вызова будет получен ответ вида:

{'hitParsingResult': \[{<mark style="color:blue;">**'valid': True**</mark>, 'parserMessage': \[], 'hit': '/debug/collect?ec=Salebot1\&ea=Вход в бот1\&ev=20\&t=event\&v=1\&tid=UA-213816105-1\&cid=860822573.9377922815'}], 'parserMessage': \[{'messageType': 'INFO', 'description': 'Found 1 hit in the request.'}]}, где

'valid': True - признак успешно выполненного запроса, параметры переданы верно.



При вызове функций для передачи данных в google analytics, некоторые параметры передаются **автоматически**, информация ниже написана для общего представления работы функций.

Для функций **ga\_pageview** и **ga\_transaction\_pageview** передается параметр “t”: “pageview”

Для функций **ga\_event** и **ga\_transaction\_event** передается параметр “t”: “event”

Для функций **ga\_transaction\_pageview** и **ga\_transaction\_event** дополнительно передается параметр “pa” со значением “purchase”.

Также при вызове всех функций автоматически передается параметр **cid** — это идентификатор пользователя для аналитики. Если пользователь пришел в бот с минилендинга и в минилендинг настроен, как указано выше, то этот идентификатор автоматически сохранится в переменные клиента, в переменную **\_ga**

![](https://lh4.googleusercontent.com/jiQWc5D3FCaajgAnz4ySsiWuEAunGCYqPzZrsR4r2v3sEnleO1SFE5BK2JhP938I7vSMa_TsRX7Ng0CH49elTogsGMLv7a-ChNs_WBYFhHtO90MxhGl5XOK66PX4z2o1M9Nfjq0W=s0)

Также при вызове всех функций автоматически передается параметр **cid** — это идентификатор пользователя для аналитики. Если пользователь пришел в бот с минилендинга и в минилендинг настроен, как указано выше, то этот идентификатор автоматически сохранится в переменные клиента, в переменную **\_ga**

если у клиента не окажется данной переменной, то она генерируется автоматически из рандомного набора цифр, но при таком условии рекомендуется передать в дополнительных параметрах источник трафика описание ниже (Переопределение источника).

### **Как переопределить источник (для** Universal Analytics)

Если вам необходимо вручную задать источник трафика для вашего события - можно дополнить любой из типов запроса следующими параметрами.

Словарь ниже - не является самостоятельным, используется только при вызовах функций описанных ниже в поле Дополнительные параметры

`'{ "cs":"#{utm_source}", "cm":"#{utm_medium}", "cn":"#{utm_campaign}", "ck":"#{utm_term}", "cc":"#{utm_content}"}'`

Документация по параметрам:

[**https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters?hl=ru#trafficsources**](https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters?hl=ru#trafficsources)

### **Как использовать запросы типа События (t:events) (для** Universal Analytics)

Используются в Google Analytics для фиксации наступления определенных событий В GA можно настраивать цели, которые фиксируются при наступлении определенных событий. (т.е. не все события передаваемые события должны быть обязательно целью)

Увидеть события можно в разделе Поведение -> События -> Лучшие события

![](https://lh4.googleusercontent.com/zIsidTWaZDQr9un89LIltYl4QCS-GdEqhskECWkahZDleZ3EOtg7usCE7mzqiTpzN-5S2foD3XozziB9LeiyhYiVr4XqN0JqS3ROhA5ZYyc_uv0fVbD20nnf2eGdE38zeTEtGqk3=s0)

В данном примере вы можете увидеть сколько было переходов в те блоки, откуда настроили передачу данных.

## **Как настроить цель на событие (для** Universal Analytics)

На самые значимые этапы воронки можно настроить цели и использовать их для отслеживания конверсии между этапами. Цели настраиваются в раздел “Представление” -> Цели

![](https://lh3.googleusercontent.com/eiFjlz9zXYt5j2k3aIS-TCcwwGDLlWuuApvPuZNDm7bgyRTti41ScgDiC5NVzLUVJdoWnKHBym8b-6fCnsLGSLt0kPqspxWIMt4hXvqKcZgAFO0t2FhNZ5J5tS3f2X31NKlk1cjA=s0)

![](https://lh3.googleusercontent.com/dcjvlxB1-7uzLA_ee4UvUAKF4OT1hPcKmpVsystXWrdA_f-zd7i-I3_joDTvu-8mDSEmI8ToBmc3S1m6xdvbTkaxngmPuS0PGKu_Zis9N2nQxqkgsmEClrUwllDHU7_1lUqus_pl=s0)

![](https://lh5.googleusercontent.com/XsoBCQwfFSq-kfPtfNMV7CIxU1eT4rulB2yoiXNzyJINKla7-sOCKj3rjxhivsvtJ-FbwPs0baQyHHoc8rX-Jy69sAZ055F5BggAgESctZomfkViwSHRxYxagASDAEBUbpMIvirm=s0)

## **Как использовать запросы типа Просмотр страниц (t:pageview) (для** Universal Analytics)

Передачей данных о просмотре страницы вы имитируете посещение пользователем веб-страницы. Увидеть стандартный отчет по страницам можно в разделе “Поведение -> Контент сайта”

![](https://lh6.googleusercontent.com/2I-0zETgBpCXoydTGhv0kzwbq4FdCmCy6-Imvns0N14V-ntvC4X4aTAqE6TAxYG9u8ecmHIgnIVl3nm-SO-vIdyJgfI9xv_BXAaGqHK1rusNDXaV-YqhjvlRied3Zvuifoi7zo-S=s0)

Если настроить цель на посещение ряда страниц, можно получить визуальную воронку движения по ветке бота, не выходя из Google Analytics.

![](https://lh4.googleusercontent.com/vGnIKIlNGC7mWw8OGVRVGWC-vQXF07DeP1GCo3A_T5qJuY6aHyy_4nQWez5rGsERrh1o9ihSlRj6PFjHptS8QWoZmCoX_LUCfk8Oj4G780lb2EYcO_t-4n94DDVyn1Aane4_bitb=s0)

Пример настройки:

![](https://lh6.googleusercontent.com/SgoQRQD6n8gg-2pFr0pEWrZnbtmpxBW83ProZxZywWT_qlcsaBZy2aAWa0xVjcg-UeByW8AjpevPjrpjWiVgDZkwzf-6JTEXeb9gPukGqPfBkKF8Mb1fh0ECYzN0hMb3iwIyR1hK=s0)

Плюс данного подхода — наглядное представление движения по воронке не выходя из аналитикса.

Минус - по сути вы передает всего один параметр - посещение какого-то блока. Доп данные, такие как Ярлык или ценность, как в запросах Events тут не передать.

Чтобы передать данные о “посещении страницы” в Google Analytics при переходе в блок необходимо, в поле Калькулятор, вызвать функцию **ga\_pageview()** с необходимыми параметрами.

**ga\_pageview('путь URL страницы', 'заголовок'**, '{"название параметра": "значение", "название параметра2": "значение3"}', 'признак теста')

**где:**

1. **путь URL страницы -** Часть URL страницы, определяющая путь.
2. **заголовок -** Заголовок страницы/документа
3. Словарь с дополнительными параметрами вида '{"название параметра": "значение", "название параметр2": "значение2"}'
4. **признак теста** - необязательный параметр. Может быть передано любое значение, достаточно передать значение 1. Позволяет протестировать корректность построения запроса без передачи данных на сервер аналитики

{% hint style="warning" %}
<mark style="color:red;">**Внимание!**</mark> Не забывайте убирать признак теста после проверки.
{% endhint %}

**Примеры вызова функции:**

ga\_pageview('/start, 'Точка входа')\
ga\_pageview('/pay', 'Покупка', '{"cd1": "High Scores"}')

![](https://lh6.googleusercontent.com/yZ0HakHZwWQF6Zqmd5YKQUKxQOB5FG0zt8WL90td-d-Q7UJHlKaQkOO3BtlD-Nd1OXL7qIV8zxsZgK-Un7De_9yt22bMgbtdQJKvN-YtCmOcNY37i3QtbcIJRx2wV1lf-uxRHFpk=s0)

Для передачи дополнительных параметров, воспользуйтесь документацией ниже. В ней содержатся все возможные параметры с подробным описанием:

[https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters?hl=ru#content](https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters?hl=ru#content)

## **Как работать с расширенной электронной торговлей (для** Universal Analytics)

![](https://lh3.googleusercontent.com/P-Yk0cNyR6yC_ASiCCe8O6Pwp726wgZB4LRST2_-UM9qrR1Glj8Qi4rtBiDIQe12FCL_2bIZGRF-WIvhHMyoc1u-CnmRNAEqKP8jLvqiVqiZF0y67ofEa9ryTjBh809-o4M4XFLh=s0)



{% hint style="warning" %}
Параметры расширенной электронной торговли нужно отправлять в существующих обращениях (pageview, event)
{% endhint %}

Для этого предусмотрено две функции: **ga\_transaction\_pageview** и **ga\_transaction\_event**.

### **Функция ga\_transaction\_pageview (для** Universal Analytics)

Обязательные параметры выделены жирным:

**ga\_transaction\_pageview('идентификатор транзакции', 'общий доход', 'путь URL страницы', 'заголовок',** 'список товаров', 'словарь дополнительных параметров', 'признак теста'**)**

**Пояснение к параметрам из примера**

1. Уникальный идентификатор транзакции
2. Общий доход, связанный с транзакцией
3. Часть URL страницы, определяющая путь.
4. Заголовок страницы/документа
5. Массив товаров '\[\["id", "name", "цена", "количес**т**во"], \["id", "name", "цена", "количество"]]'
6. Словарь с дополнительными параметрами вида '{"название параметра": "значение", "название параметр2": "значение2"}'
7. признак теста - необязательный параметр. Может быть передано любое значение, достаточно передать значение 1. Позволяет протестировать корректность построения запроса без передачи данных на сервер аналитики

{% hint style="warning" %}
<mark style="color:red;">**Внимание!**</mark> Не забывайте убирать признак теста после проверки.
{% endhint %}

Примеры вызова функции:

ga\_transaction\_pageview('#{order\_id}', '2200', '/send', 'Получил', '\[\["222", "Курс1", "1200", "1"], \["223", "ДопКурс", "1000", "1"]]')

ga\_transaction\_pageview('123', '100', '/pay', 'Оплатил', '', '{"cd": "High Scores", "cs":"#{utm\_source}", "cm":"#{utm\_medium}", "cn":"#{utm\_campaign}"}' )

Массив товаров имеет следующий вид - массива массивов:

'\[\["id\_товара", "название товара", "цена товара", "количество товара"], \["id\_товара", "название товара",  "цена товара", "количество товара"]]'

Каждый товар должен иметь 4 параметра, общий массив в одинарных кавычках, параметры внутри в двойных.

### **Функция ga\_transaction\_event (для** Universal Analytics)



Обязательные параметры выделены жирным:

**ga\_transaction\_event ('идентификатор транзакции', 'доход от транзакции', 'категория события', 'действие события', 'метка'**, 'ценность события', 'массив товаров', 'другие параметры'**)**

Пояснение к параметрам из примера:

1. Уникальный идентификатор транзакции
2. Общий доход, связанный с транзакцией
3. категория события - обязательный
4. действие события - обязательный
5. метка события
6. ценность события. Передается в целых числах, запишется в той валюте, которая указана в настройках представления
7. Массив товаров '\[\["id", "name", "цена", "количество"], \["id", "name", "цена", "количество"]]'
8. Словарь с дополнительными параметрами вида '{"название параметра": "значение", "название параметр2": "значение2"}'
9. признак теста - необязательный параметр. Может быть передано любое значение, достаточно передать значение 1. Позволяет протестировать корректность построения запроса без передачи данных на сервер аналитики

{% hint style="warning" %}
<mark style="color:red;">**Внимание!**</mark> Не забывайте убирать признак теста после проверки.
{% endhint %}

**Примеры вызова функции:**

ga\_transaction\_event('1244', '121.2', '1категория',  'действие', 'ярлык', '10', '\[\["11", "Товар1", "1.2", "1"], \["22", "Товар2", "120", "1"]]')

ga\_transaction\_event('1244', '1.2', '1категория',  'действие', '', '', '\[\["11", "Товар1", "1.20", "1"]]')

ga\_transaction\_event('1244', '121.2', '1категория',  'действие', 'ярлык', '10', '\[\["11", "Товар1", "1.2", "1"], \["22", "Товар2", "120", "1"]]', '{"ta": "Google Store", "cs":"#{utm\_source}", "cm":"#{utm\_medium}", "cn":"#{utm\_campaign}"}' )

Массив товаров имеет следующий вид массива массивов:

'\[\["id\_товара", "название товара", "цена товара", "количество товара"], \["id\_товара", "название товара",  "цена товара", "количество товара"]]'

{% hint style="info" %}
Каждый товар должен иметь 4 параметра, общий массив в одинарных кавычках, параметры внутри в двойных.
{% endhint %}
{% endtab %}
{% endtabs %}

### Как передать  параметр UTM в GA4

В документации Google нет описания передачи данного параметра. Когда будет добавлено, в функции можно будет передать UTM. \
Поиск в интернете подтверждает, что на данный момент нет возможности передать UTM:

<figure><img src="../../.gitbook/assets/image (211).png" alt="" width="552"><figcaption></figcaption></figure>

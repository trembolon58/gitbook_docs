---
description: Описание работы с кредитованием и рассрочками от Т-банк в Salebot
---

# Т-банк Кредитование/Рассрочка

Вы можете выдавать рассрочки и кредиты на ваши услуги и продукты. В документации подробно описали работу с данным функционалом. \
\
Для использования Тинькофф кредитования нужно сперва подключить услугу в банке. Сам банк предлагает такую инструкцию:\
\
[https://www.tinkoff.ru/business/help/sales/loans/how-to-integrate/API/<br>](https://www.tinkoff.ru/business/help/sales/loans/how-to-integrate/API/)\
После того как вы выполнили все шаги на стороне банка для подключения к salebot вам потребуются следующие данные: Shop\_id, Showcase\_id и Api\_password\
Если возникнут сложности с получением этих параметров, обратитесь в поддержку банка.\
\
❗️Если вы планируете работать именно с рассрочками от банка, то в личном кабинете руководителя вам необходимо включить данный функционал и получить промокод (параметр - **promo\_code**), передавая его в функции в банк поступит заявка именно на рассрочку, а не на кредит. \
Где получить данный параметр показали в скриншотах: <br>

<figure><img src="/broken/files/jABtvRH9fr4yJmCiz6Yv" alt=""><figcaption><p>Включите подходящий тип рассрочки в личном кабинете руководителя <br></p></figcaption></figure>

<figure><img src="/broken/files/UvgsKXK8EHjLZx5AFDqZ" alt=""><figcaption><p>Скопируйте промокод и используйте его в функции создания заявки. </p></figcaption></figure>

\
Когда все необходимые данные вами получены, перейдите в раздел "Платежные системы" и  нажмите подключить под названием Tinkoff Credit\
<br>



<figure><img src="/broken/files/S2Gp4dKunDMtyHC2HKdV" alt=""><figcaption><p>расположение кнопки подключения Кредитования от Тинькофф</p></figcaption></figure>

В открывшемся окне введите данные которые на шаге подключения Кредитования вы получили в банке: Shop\_id, Showcase\_id и Api\_password<br>

<figure><img src="/broken/files/UoVC9kpKr0sHLoxYWSDN" alt=""><figcaption><p>форма ввода данных для подключения </p></figcaption></figure>

Если все сделано правильно то вид кнопки под названием интеграции сменит вид на такой:\
<br>

<figure><img src="/broken/files/aD8rWtZcLXSCpgTs5lEV" alt=""><figcaption><p>корректное подключение</p></figcaption></figure>

После того как платежная система вами подключена, вы можете перейти к настройкам. В работе вы сможете использовать три функции, которые подробно описаны ниже.&#x20;

### **Создание заявки на кредит**

**tinkoff\_credit\_create\_invoice(total\_sum, items, promo\_code, webhook\_use, values, test)**\
\
Параметры функции: \
\
**total\_sum** - общая сумма кредита, она должна равняться сумме элементов следующего параметра. <mark style="color:green;">Обязательный параметр</mark>

**items** - список товаров. <mark style="color:green;">Обязательный параметр.</mark>\
\
&#x20;Список товаров должен иметь такой вид:

`items = [{"name": "тестовый товар", "quantity": 1, "price": 30000.00}]`\
\
По этому списку вычисляем общую сумму. Каждый входящий товар указываем в отдельном словаре через запятую. \
Сумма в первом параметре должна совпадать с суммой произведения количества (quantity) и цены (price) в каждом объекте. В данном примере итоговая сумма по товарам 30000, так как здесь 1 товар, у которого цена 30000 и кол-во всего 1.\
\
**promo\_code** - <mark style="color:orange;">необязательный параметр</mark>, **для создания заявки на рассрочку**, если не используется, то можно передать в нем пустую строку или ноль. Вы можете сохранить параметр в переменную и указать его в функции или задать его в кавычках. \
Если у вас несколько типов рассрочки, с разным количеством платежей и сроками, то можно использовать несколько функций, или заполнить параметр **promo\_code** в зависимоти от выбора клиента. Например предложив ему указать на какой срок он хочет получить рассрочку нажатием кнопки. Полученные данные используйте в выражении [с условным оператором](https://docs.salebot.pro/peremennye-1/kalkulyator/uslovnyi-operator-if) и назначьте параметру **promo\_code**  нужное значение.&#x20;

**webhook\_use** - если хотите получать вебхук по этой заявке, напишите в этом параметре 1, если нет - 0. <mark style="color:orange;">необязательный параметр.</mark> \
Если при его передаче функция не работает, то передайте 0 и настройте получение вебхука через кабинет руководителя, как указано в данной [инструкции ](t-bank-kreditovanie-rassrochka.md#nastroika-vebkhuka)

**values** - <mark style="color:orange;">необязательный параметр</mark>, может включать данные получателя кредита, чтобы заявка была предзаполнена его личными данными.\
Пример заполненного параметра values:

`values = {"contact": {"fio": {"lastName":"Фамилия клиента", "firstName":"Имя клиента","middleName":"Отчество клиента"}, "mobilePhone":"Телефон клиента(10 цифр, без +7)", "email":"Email клиента"}}`

**test** - <mark style="color:orange;">необязательный параметр</mark>, если хотите создать тестовую заявку, передайте в этом параметре 1. Тестовые заявки никогда не попадут к банкам.\
\
Не забудьте присвоить ответ функции переменной. В ней окажется общая информация по заявке или информация по ошибке, если что-то было сделано неверно. В случае успешного создания также будут созданы переменные в сделке с этим клиентом. Всего будет 3 переменных:

**tinkoff\_credit\_id** - содержит id заявки внутри Тинькофф, нужна будет если захотите настроить и использовать вебхук

**tinkoff\_credit\_order\_id** - id, по которому нужно будет отправлять запросы в других функциях (id внутри Salebot)

**tinkoff\_credit\_link** - содержит ссылку на заявку. Передайте ее клиенту для оформления кредита<br>

<figure><img src="/broken/files/HvghI03RdGBDyuwtBQhJ" alt=""><figcaption><p>пример параметров функции и самой функции без рассрочки</p></figcaption></figure>

{% hint style="danger" %}
Если вы получили ошибку:\
{"validations":{"webhookURL":"Для ссылки возврата некорректно указан домен, он должен совпадать с доменом вашего сайта"},"errors":\[]}<br>

Вебхук  пропишите в кабинете руководителя, а в функции в параметре **webhook\_use** передайте значение 0
{% endhint %}

\
После того как заявка на кредит направлена из salebot в банк, вы можете выбрать один из двух вариантов для продолжения работы. \
1\. Настроить автоподтверждение на стороне Тинькофф и тогда деньги автоматически будут поступать после подписания кредитного договора. \
2\. Можете получить подтверждение одобрения заявки одним из двух способов: функция или вебхук.\
Используя функцию вы подтверждаете готовность провести сделку через ее использование.&#x20;

### Подтверждение или отмена заявки <br>

**tinkoff\_credit\_action(action, order\_id)**\
Параметры функции:&#x20;

**action** - <mark style="color:green;">обязательный параметр</mark>, должен содержать действие с кредитом. Есть 2 варианта действий: \
&#xNAN;_"commit"_ - для подтверждения подписанной заявки на кредит (после выполнения деньги от банка будут зачислены на счет продавца)\
&#xNAN;_"cancel"_ - для отмены заявки

**order\_id** - <mark style="color:orange;">необязательный параметр</mark>, но может быть полезен если активна не та сделка, в рамках которой создавалась заявка на кредит. \
По умолчанию действие в функции применяется к кредиту, запрошенному в рамках текущей сделки, но если вы закрыли сделку, то придется взять переменную tinkoff\_credit\_order\_id и передать ее в этом поле, для действий с соответствующей заявкой.

<figure><img src="/broken/files/ANhGCm8ohLzpEkOIZJc8" alt=""><figcaption><p>Пример работы с функцией. Параметры в функции указываются в кавычках. </p></figcaption></figure>

Пример для копирования: \
для работы с заявкой, оформленной вне текущей сделки

`answer = tinkoff_credit_action("commit", "42480-41757")`\
`answer = tinkoff_credit_action("cancel", "42480-41757")`

Для работы с заявкой внутри текущей сделки\
`answer = tinkoff_credit_action("commit")`\
`answer = tinkoff_credit_action("cancel")`<br>

### Определение этапа заявки

**tinkoff\_credit\_info(order\_id)** - возвращает необходимую информацию, включая статус заявки.\
Функция принимает один параметр order\_id - идентификатор текущей сделки. \
Используя данную функцию вы можете инициировать проверку статуса заявки на кредит или рассрочку. В ответе от функции вы получите все необходимые данные для работы. \
\
`answer = tinkoff_credit_info("42480-41757")`

или

`answer = tinkoff_credit_info()`\
\
Также вы можете указать вручную стоимость сделки, чтобы отслеживать в том числе и полученные через кредитования средства внутри SalebotCRM.

Для этого объявите переменную budget в калькуляторе и сделка будет иметь сумму, указанную в этой переменной

при присвоении переменной воспользуйтесь такой записью:

`budget = 40000`\
\
в разделе клиенты в сделках увидите следующее

<br>

<figure><img src="/broken/files/Ia4uSjFspnKrmZnicCDW" alt=""><figcaption><p>пример сделки с заданным бюджетом</p></figcaption></figure>

### Настройка вебхука

Для того чтобы принимать рассрочки от Брокера Тинькофф с автоматической отправкой вебхука необходимо создать дополнительную точку(интернет-магазин).

Переходим по адресу: [https://business.tinkoff.ru/posbroker/markets](https://business.tinkoff.ru/posbroker/markets)

Нажимаем кнопку **добавить.**<br>

<figure><img src="/broken/files/jvUvOvPsdKmQ7xBwPTRN" alt=""><figcaption><p><br></p></figcaption></figure>

**Тип магазина** - Интернет магазин\
**Название** - любое \
**Сайт** - обязательно указываем часть адреса нашего вебхука с поддоменом: [https://chatter.salebot.pro](https://chatter.salebot.pro)\
**Вебхук** - https://chatter.salebot.pro/tinkoff\_credit/status\
&#x20;Обратите внимание, что название сайта после сохранения, отредактировать нельзя.

{% hint style="info" %}
Обратите внимание, что название сайта после сохранения, отредактировать нельзя.
{% endhint %}

После добавления магазина нажимаем кнопку настройки API

<figure><img src="/broken/files/VcSn38a6sP2k8TazYAKm" alt=""><figcaption><p><br></p></figcaption></figure>

Придумываем пароль и обязательно нажимаем кнопку установить пароль. Без установленного пароля **интеграция работать не будет это ВАЖНО.**<br>

<figure><img src="/broken/files/4PTyMmv13KuKmG6y6aqa" alt=""><figcaption><p><br></p></figcaption></figure>

После установки пароля заходим в реквизиты, и нажимаем кнопку редактировать.\
Ставим галочку Автоподтверждение интернет заказов.<br>

<figure><img src="/broken/files/GrAdgTASFFqvUQJecN3a" alt=""><figcaption><p><br></p></figcaption></figure>

Далее в реквизитах копируем **shopId**

<figure><img src="/broken/files/6uqw3b72wUV49z15P1uL" alt=""><figcaption><p><br></p></figcaption></figure>

В разделе магазины выбираем наш магазин. И копируем showcaseId<br>

<figure><img src="/broken/files/urFbqvOLuq2tF5KzQkPh" alt=""><figcaption><p><br></p></figcaption></figure>

Далее переходим в конструктор, раздел платежные системы. Выбираем Tinkoff Credit и вводим скопированные данные и пароль. Настраиваем блок с созданием заявки с параметрами, указанными выше.

<figure><img src="/broken/files/pQtMWKy7wGc8Fqb0ljp3" alt=""><figcaption><p><br></p></figcaption></figure>

Теперь вебхуки будут приходить автоматически. В диалоге клиента вебхук выглядит так как показано в скриншоте ниже:&#x20;

<figure><img src="/broken/files/EMsaY7TjHfjuWiN6ISSa" alt=""><figcaption><p><br></p></figcaption></figure>

**Какие вебхуки приходят в диалог клиента:**&#x20;

**12345\_approved** - для подтвержденного (банк одобрил заявку, но документы на выдачу кредита не получены). \
**12345\_signed** - для подписанного (можно подтверждать сделку и банк перечислит кредитные средства). \
**12345\_rejected** - банк отказал в выдаче кредита, можете попробовать предложить клиенту другие способы оплаты, если они есть. \
**12345\_canceled** - вы отменили заявку.\
\
Также если хотите использовать SalebotCRM для учета выданных кредитов, не забудьте после завершения сделки завершить ее внутри бота, проведя клиента через блок "Конец сбора данных" (красный). \
<br>

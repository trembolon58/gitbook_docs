---
description: Белорусская система электронных платежей
---

# Webpay

* [Как подключить](webpay.md#podklyuchenie)
* [Как сформировать ссылку на оплату](webpay.md#primer-formirovaniya-ssylki-na-oplatu)
* [Как обработать результат](webpay.md#obrabotka-rezultata)
* [Как тестировать](webpay.md#testirovanie)

## Как подключить

Для подключения платежной системы Webpay переходим в личный кабинет [https://billing.webpay.by](https://billing.webpay.by) перейти к разделу меню "Настройки" → "Компания".

Здесь нужно взять два значения.\
Первое — это идентификатор мерчанта (Биллинг ID):

![Рис. 1. Копируем Биллнг ID](https://lh4.googleusercontent.com/GSzDY9Ug0w34ZzrI6V9N0P1Z1xc8iAQzRgroPI99argfUNbFyyNaLj7TCKhxW_iR7ow6ZCVgiAKpOCdzLioVRYZ4pkWokiwaLgQDoMjqoim8wXXffZJeeO7GgycwvLtaqlUfGCE5)

Второе — нужно заполнить поле Секретный ключ (рис. ниже) — заполняем случайной последовательностью символов за исключением знака &&#x20;

![Рис. 2. Заполнение поля "Секретный ключ"](https://lh5.googleusercontent.com/XUzS80nA03gI1nh7y3jkNxlEb-cVfBB-Zu0riKV_INrHd8_-LOrG1_DpKZz7qSupe7mT3OESFceBgUUamzfGdfof7O4n6KICtQBm2J1JrtnmiDHNL5lQXXZrmtFIt2NK8ga5b51x)

{% hint style="danger" %}
Секретный ключ должен быть не короче 10 символов, без символа &
{% endhint %}

Сохраняем настройки, копируем введенный секретный ключ и переходим к настройкам в Salebot.\
Открываем раздел "Эквайринг", выбираем Webpay:

<figure><img src="../.gitbook/assets/Снимок экрана 2025-07-01 в 17.25.06.png" alt=""><figcaption><p>Рис. 3. Раздел "Эквайринг" в Сейлбот</p></figcaption></figure>

&#x20;Нужно ввести полученные данные:

<figure><img src="../.gitbook/assets/Снимок экрана 2025-07-01 в 17.26.02.png" alt=""><figcaption><p>Рис. 4. Подключение платежного сервиса</p></figcaption></figure>

Далее нажмите на "Сохранить настройки", тогда сервис будет подключен к вашему проекту.

## **Как сформировать ссылку на оплату**

{% hint style="warning" %}
Для генерации ссылки на оплату вам необходимо установить значение переменной **payment\_sum** (например, 150 или 100.55 (**через точку!**))
{% endhint %}

<figure><img src="../.gitbook/assets/Снимок экрана 2025-07-01 в 17.29.29.png" alt=""><figcaption><p>Рис. 5. Указываем переменную payment_sum в калкуляторе </p></figcaption></figure>

Сразу после этого появится переменная **webpay\_pay\_url**.

Ссылка имеет вид: \
[https://secure.webpay.by?wt=581991eb9e6a9cd9eb574c15f455c073=596e5245614568686246564952314a76616b4e425348684564585a51636b56695a6d46455443395455455135646b564c4f4764765a6c4e4f65575a7063445a724f5659345530773463545673566b356d616d51304e512c2c](https://secure.webpay.by/?wt=581991eb9e6a9cd9eb574c15f455c073=596e5245614568686246564952314a76616b4e425348684564585a51636b56695a6d46455443395455455135646b564c4f4764765a6c4e4f65575a7063445a724f5659345530773463545673566b356d616d51304e512c2c)

Переменную #{**webpay\_pay\_url**} указывается через конструкцию #{} в поле url в настройках вложений, либо в настройках кнопки, либо в тексте сообщения:

1. В настройках кнопки:

<figure><img src="../.gitbook/assets/Снимок экрана 2025-07-01 в 17.32.03.png" alt=""><figcaption><p>Рис. 6. Указываем переменную #{<strong>webpay_pay_url</strong>}  в поле url кнопки</p></figcaption></figure>

<figure><img src="../.gitbook/assets/Снимок экрана 2025-07-01 в 17.32.30.png" alt=""><figcaption><p>Рис. 7. Настройки блока</p></figcaption></figure>

2. В поле url в настройках вложения:

<figure><img src="../.gitbook/assets/Снимок экрана 2025-07-01 в 17.34.41.png" alt=""><figcaption><p>Рис. 8. Указываем переменную #{<strong>webpay_pay_url</strong>}  в поле url вложения</p></figcaption></figure>

3. В поле "Сообщение":

<figure><img src="../.gitbook/assets/Снимок экрана 2025-07-01 в 17.37.52.png" alt=""><figcaption><p>Рис. 9. Указываем переменную #{webpay_pay_url} в поле "Сообщение"</p></figcaption></figure>

Также до установки значения переменной **payment\_sum**, можно задать следующие **необязательные** переменные, для настройки платежа:

{% hint style="warning" %}
Внимание! По умолчанию установлена валюта Белорусский рубль, если нужна другая валюта, нужно установить значение переменной **currency**
{% endhint %}

**currency** — валюта заказа. Допустимые значения: BYN, USD, EUR, RUB

**store\_name** — название магазина, которое будет отображаться на форме оплаты. По умолчанию берется из настроек биллинг-аккаунта

**product\_name** – наименование товара

**language** — язык страницы оплаты, по умолчанию русский. Допустимые значения: russian, english

**session\_timeout** — продолжительность жизни заказа в секундах. По умолчанию 1200 секунд (20 минут).

![Рис. 10. Информация о платеже](https://lh4.googleusercontent.com/AcWP30ezz5gP4kFkYCwtKP7r24zP-efSbOAnxXOnFi3LM2a32bBFWIoRfWr8MkjUjdqqu8AjwUH5NhzO2VKHwhyoXG435ZhpLpfhvPmQiZqSdJDLFYF9DGMvAJ-rhrQ4sMmuSRe6)

Создадим ссылку на оплату в размере 10 бел. рублей (по умолчанию бел. рубль)

<figure><img src="../.gitbook/assets/Снимок экрана 2025-07-01 в 17.43.44.png" alt="" width="563"><figcaption><p>Рис. 11. Настройки калькулятора</p></figcaption></figure>

{% hint style="info" %}
**Обратите внимание:** \
\- Сначала указываете необязательные параметры  **product\_name** и т.д.\
\- И последней присваиваем значение переменной **payment\_sum**
{% endhint %}

Обратите внимание, вначале задаем дополнительные переменные для настроек, затем **payment\_sum**. Переменные можно задать и ранее в цепочке, а не в одном блоке, это приме&#x440;**.**

Далее в нужном месте выводим переменную **webpay\_pay\_url**, в которой содержится ссылка (см. рис. 6 — 9).

## **Как обработать результат**

После успешной оплаты в бот придут колбэки, по которым вы сможете понять, что была успешная оплата. Эти колбеки в системе вы видите как сообщения от пользователя, чтобы их не мог отправить пользователь, они состоят из 10 первых символов секретного ключа и приписки \_success, например: **895f1840b9\_success**   &#x20;

{% hint style="warning" %}
Если секретный ключ менее 10 символов, то он будет использован полностью + приписка **\_success.**
{% endhint %}

<figure><img src="../.gitbook/assets/Снимок экрана 2025-07-01 в 17.46.08.png" alt=""><figcaption><p>Рис. 12. Колбек об успешном платеже</p></figcaption></figure>

Эти колбэки НЕ ВИДИТ пользователь, они отображаются только оператору.\
Тип сравнения должен быть **"Полное совпадение"**

Также после успешной оплаты переменная **webpay\_payment\_completed** устанавливается в **True**.&#x20;

Например, можно сделать обработку успешной оплаты блоком с условием и вывести соответствующее сообщение пользователю:

Пример 1:

<figure><img src="../.gitbook/assets/Снимок экрана 2025-07-01 в 17.47.38.png" alt=""><figcaption><p>Рис. 13. Указываем колбек в поле условие в блоке "Стартовое условие"</p></figcaption></figure>

Пример 2:

<figure><img src="../.gitbook/assets/Снимок экрана 2025-07-01 в 17.47.20.png" alt=""><figcaption><p>Рис. 13. Указываем колбек в поле условие в блоке "Стартовое условие"</p></figcaption></figure>

{% hint style="info" %}
Если вы не хотите выбивать клиента из основной схемы чат-бота, воспользуйтесь блоком "Не состояние с условием" — в этот блок нельзя перейти, поэтому клиента после оплаты не выбьет из основной воронки и при этом он получит уведомление об успешной оплате.

А если вам нужно продолжить воронку с реакции на успешную оплату, то используйте блок "Стартовое условие", тогда клиент из блока оплаты перейдет в блок "Стартовое условие", с которого вы можете продолжить воронку.
{% endhint %}

{% hint style="info" %}
Подробнее о [блоках с условием рассказали](/broken/pages/VktePfPMzzJlbjBSqE93) в одноименной статье.
{% endhint %}

{% hint style="warning" %}
Для совершения повторного платежа обязательно необходимо обнулить payment\_sum, ранее сформированную ссылку и уже после переназначить переменную payment\_sum для получения свежей ссылки. Можно указать предыдущее значение.
{% endhint %}

После завершения оплаты клиенту добавится переменная **webpay\_callback\_data**, содержащая данные ответа платежной системы по совершенной операции. Из полученного словаря можно извлечь необходимые данные при помощи метода **get**.

## Как тестировать

Для проведения тестовых платежей установите переменной **test\_payments** значение **1**

# Отписка клиента от бота

## Как полностью отписать от сообщений

Например, в Whatsapp отсутствует возможность запретить сообщения, и, чтобы пользователь не нажал кнопку "СПАМ", вам необходимо по его требованию останавливать рассылки.

Во всех других мессенджерах есть системная возможность: ниже приведен пример кнопки отписки во ВКонтакте:

<figure><img src="../.gitbook/assets/Снимок экрана 2025-04-30 в 15.40.16.png" alt="" width="563"><figcaption></figcaption></figure>

Если _<mark style="color:green;">пользователь ВКонтакте</mark>_ нажал на эту кнопку, то он отписался от всех сообщений и бот не сможет отправить сообщений. \
\
В диалог с клиентом придет уведомление об отписке, а во вкладке "О клиенте" появится отметка, что клиент отказался от сообщений бота (отписался): сообщение с крестиком.

<figure><img src="../.gitbook/assets/Снимок экрана 2025-04-30 в 15.41.44.png" alt="" width="375"><figcaption></figcaption></figure>

Если у клиента есть отметка об отписке, то сообщения пользователю не дойдут.

<figure><img src="../.gitbook/assets/Снимок экрана 2025-04-30 в 15.43.41.png" alt=""><figcaption><p>Сообщение не отправлено, клиент запретил отправку сообщений сообщества ВКонтакте</p></figcaption></figure>

{% hint style="info" %}
Помните!&#x20;

Не все мессенджеры присылают уведомления о том, что клиент отписался от сообщений.&#x20;
{% endhint %}

### Как отписаться вручную

В боте можно настроить возможность для клиента отписаться от сообщений. \
Рассмотрим на примере мессенджера Whatsapp.

Создаём блок с условием в зависимости от логики вашей воронки. Блок "_Первостепенной проверки условия"_ имеет наивысший приоритет срабатывания.

<figure><img src="../.gitbook/assets/Снимок экрана 2025-04-30 в 15.53.18.png" alt=""><figcaption></figcaption></figure>

В поле "_Условие"_ перечисляем через точку с запятой все вариант слов, которые могут написать пользователи для того, чтобы отписаться от сообщений бота. В этом блоке также повторно спросим клиента, действительно ли он хочет отписаться, и создадим две кнопки "да" и "нет".&#x20;

При попадании в блок Первостепенной проверки условия, клиенту нужно будет кликнуть по одной из кнопок, а названия кнопок пропишем в условиях стрелки:

<figure><img src="../.gitbook/assets/Снимок экрана 2025-04-30 в 15.50.42.png" alt=""><figcaption></figcaption></figure>

В следующем блоке, стрелка в который ведет по условию "Да, удалите из базы", прописываем сообщение, что клиент успешно отписался:

<figure><img src="../.gitbook/assets/Снимок экрана 2025-04-30 в 15.54.59.png" alt=""><figcaption></figcaption></figure>

Далее из блока с сообщением об успешной отписке создаем блок ниже, в котором будет заложена функция для отписки:

`unsubscribe()`

{% hint style="danger" %}
Обратите внимание!&#x20;

Внутри блока сначала обрабатываются действия в Калькуляторе, и после этого отправляется текст сообщения.

Если указать в одном блоке текст отписки и функцию отписки, клиент НЕ получит сообщение из данного блока - оно уже не будет доставлено пользователю.&#x20;
{% endhint %}

<figure><img src="../.gitbook/assets/Снимок экрана 2025-04-30 в 15.57.10.png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
**Важно!**&#x20;

Клиент подпишется на сообщения вновь, если отправит любое сообщение боту, до этого момента ни одно сообщение ему не будет отправлено.
{% endhint %}

## Как частично отписать от рассылок

Для частичной отписки вам необходимо присваивать переменные и проверять их значение перед отправкой.&#x20;

{% hint style="info" %}
Присваиваем переменные в блоке в поле Калькулятор. \
Также можно вручную в диалоге с клиентом во вкладке "О клиенте" создать переменную клиента, по которой далее будете исключать из рассылок.
{% endhint %}

Например, если пользователю присвоена переменная `рассылать_утром` со значением `нет`_,_ то в настройки фильтра рассылки можно исключить пользователей по значению переменной:

<figure><img src="../.gitbook/assets/Снимок экрана 2025-04-30 в 16.09.19.png" alt=""><figcaption><p>Настройка фильтра при создании рассылки, чтобы исключить по значению переменной</p></figcaption></figure>

Также в блоке или стрелке к блоку рассылки в поле Переменная для сравнения можно указать  `рассылать_утром == "нет"` _,_ чтобы данному человеку сообщение пришло вечером. Условия можно комбинировать по разному.

_Пример использования поля "Переменная для сравнения" при планировании сообщений:_

<figure><img src="../.gitbook/assets/Снимок экрана 2025-04-30 в 16.16.09.png" alt=""><figcaption></figcaption></figure>

Видим, что у клиента есть переменная `рассылать_утром` со значением "`нет"`.  И для него запланировалось сообщение на 20:00.&#x20;

<figure><img src="../.gitbook/assets/Снимок экрана 2025-04-30 в 16.20.51.png" alt=""><figcaption></figcaption></figure>

## Как настроить реакцию на отписку

Часто необходимо произвести какие-либо действия в боте после отписки клиента. Например, передать информацию в аналитику, добавить или исключить из списков, добавить или удалить метки, выполнить запрос на сервер и прочее.\
\
Для таких целей можно настроить блок с условием, который будет реагировать на уведомление об отписке клиента. Данный колбэк (уведомление) приходит в диалог с клиентом после того, как клиент отписался от сообщений в мессенджере (например, "Запретить сообщения" в ВК, "Остановить и блокировать  бота"  в Telegram)

<figure><img src="../.gitbook/assets/Снимок экрана 2025-04-30 в 16.02.41.png" alt="" width="375"><figcaption><p>Колбек об отписке клиента</p></figcaption></figure>

В блоке в поле Условие укажем колбек `client_unsubscribed` и Выбор соответствия - Полное соответствие.

<figure><img src="../.gitbook/assets/Снимок экрана 2025-04-30 в 16.04.26.png" alt="" width="563"><figcaption></figcaption></figure>

{% hint style="info" %}
Действия и запросы настроенные в блоке выполнятся,  но сообщение НЕ БУДЕТ  отправлено клиенту, так как клиент уже отписался.
{% endhint %}

{% hint style="success" %}
Данный коллбэк работает в ВКонтакте, Viber, Telegram.
{% endhint %}
